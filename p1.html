<html>
<meta charset="utf-8">
<head>
	<title>P1</title>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="http://d3js.org/topojson.v2.min.js"></script>
</head>
<body>
<svg height="600" width="800">

<script>
	var svg = d3.select("svg");

	var projection = d3.geoMercator();
	var pathGenerator = d3.geoPath().projection(projection);

	d3.json("city-council-districts.topojson", function (error, data) {
		var countries = topojson.feature(data, data.objects.geo);

		projection.fitExtent([[0,0], [svg.attr("width"), svg.attr("height")]], countries);
		var paths = svg.selectAll("path.country").data(countries.features);
		paths.enter()
		.append("path")
		.merge(paths)
		.attr("style", "fill:green; stroke:black")
		.attr("d", function (country) {
			return pathGenerator(country);
		});

		d3.csv("Seattle_911.csv", 
		function row (d) {
			return {
				longitude: d.Longitude,
				latitude: d.Latitude,
				datetime: d.Datetime
			};
		},
		function cb (err, data) {
			var cutoff = data.slice(0,10000);
			var points = [];
			cutoff.forEach(function (row) {
				points.push([row.longitude, row.latitude]);
			});
			var circles = svg.selectAll("circle").data(points);
			circles.enter().append("circle").attr("r", 2)
			.attr("style", "stroke:black; fill:black")
			.merge(circles)
			.attr("cx", function(d) { return projection(d)[0]; })
			.attr("cy", function(d) { return projection(d)[1]; });
		});
	});

</script>
</body>
</html>